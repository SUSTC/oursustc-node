extends ../common/layout

block stylesheet
  link(rel='stylesheet', href=base.rooturl + '/static/css/topic.css?v=#{version.css}')

block script
  script(type='text/javascript').
    function itemClick(e) {
      if (e && e.target) {
        if (e.target.tagName == 'A' || e.target.tagName == 'IMG') {
          return;
        }
      }
      var url = $(this).find('.header a').attr('href');
      if (url) {
        window.location.href = url;
      }
    }
    $('#topic_list .item').on('click', itemClick);

block bodyheader
  //include ../user/user-bar
  include ../common/banner

block treeview
  include ./tree

block content
  div(id=active)
    .ui.segment
      .ui.breadcrumb
        a.section(href='/')= lang.title.index
        .divider /
        a.section(href='/board')= lang.title.board.index
        .divider /
        if (board)
          .active.section= board.name
        else
          .active.section ...

    if (canPost)
      .ui.segment
        a.ui.blue.button(href=base.rooturl + '/#{active}/add')
          i.add.icon
          = lang.topic.add

    .ui.divided.list.segment#topic_list
      each topic in topics
        .item
          if (topic.author)
            - var u = topic.author;
            include ../user/user-round
          .content
            .header
              a(href=base.rooturl + '/topic/#{topic._id}')= topic.title
            p
              span.time 
                | #{lang.info.create_at}: #{topic.friendly_create_at}
                if (topic.last_reply)
                  | &nbsp;&nbsp;#{lang.info.last_reply_at}: #{topic.friendly_last_reply_at}
          .right.floated.ui.grid
            .eight.wide.column.computer.only.numbers
              .info
                strong.number= topic.visit_count
                | #{lang.topic.visit_count}
              .info
                strong.number= topic.reply_count
                | #{lang.topic.reply_count}
          if (topic.author_id)
            .user-topics
              a(href=base.rooturl + '/topic/page/#{topic.author_id}')
                i.suitcase.icon

      else
        .ui.icon.message
          i.icon.exclamation
          .content
            .header= lang.info.tips
            p= lang.topic.topics_not_found

    include ../common/pagination