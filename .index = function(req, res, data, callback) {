[1mdiff --git a/src/control/enigma.js b/src/control/enigma.js[m
[1mindex 865183d..fc29244 100644[m
[1m--- a/src/control/enigma.js[m
[1m+++ b/src/control/enigma.js[m
[36m@@ -1,9 +1,6 @@[m
 (function() {[m
 [m
   var EventProxy = require('eventproxy');[m
[31m-  var _ = require('underscore');[m
[31m-  var gm = require('gm').subClass({ imageMagick : true });[m
[31m-[m
 [m
   //table = require("./../base/table");[m
   var config = require('./../config/config.json');[m
[36m@@ -15,11 +12,15 @@[m
     UserAccountProxy = proxy.UserAccount;[m
 [m
   exports.index = function(req, res, data, callback) {[m
[31m-[m
     data.err = 0;[m
     data.title = "Hello World!";[m
     callback(true);[m
[32m+[m[32m  };[m
 [m
[32m+[m[32m  exports.online = function(req, res, data, callback) {[m
[32m+[m[32m    data.err = 0;[m
[32m+[m[32m    data.message = "Online Client:";[m
[32m+[m[32m    callback(true);[m
   };[m
 [m
   exports.auth = function(req, res, data, callback) {[m
[36m@@ -100,7 +101,7 @@[m
     }[m
 [m
     Enigma.addClient(account, newClient, function(err, msg){[m
[31m-      if(err != 1){[m
[32m+[m[32m      if(err != 0){[m
         data.err = -1;[m
         data.message = "DB_ERROR";[m
       }[m
[1mdiff --git a/src/model/enigma_cli.js b/src/model/enigma_cli.js[m
[1mdeleted file mode 100644[m
[1mindex 9285513..0000000[m
[1m--- a/src/model/enigma_cli.js[m
[1m+++ /dev/null[m
[36m@@ -1,15 +0,0 @@[m
[31m-var mongoose = require('mongoose');[m
[31m-var Schema = mongoose.Schema;[m
[31m-//var ObjectId = Schema.ObjectId;[m
[31m-[m
[31m-var EnigmaClientSchema = new Schema({[m
[31m-  lanIP: { type: String },[m
[31m-  wanIP: { type: String },[m
[31m-  onlineTime: { type: Date, default: Date.now }[m
[31m-});[m
[31m-[m
[31m-/*EnigmaClientSchema.virtual('timeUpdate').get(function () {[m
[31m-  [m
[31m-});*/[m
[31m-[m
[31m-mongoose.model('EnigmaClient', EnigmaClientSchema, config.DB_PREFIX + 'enigma_cli');[m
\ No newline at end of file[m
[1mdiff --git a/src/model/index.js b/src/model/index.js[m
[1mindex c76f660..fef5b2e 100644[m
[1m--- a/src/model/index.js[m
[1m+++ b/src/model/index.js[m
[36m@@ -2,7 +2,6 @@[m [mvar mongoose = require('mongoose');[m
 var config = require("./../config/config.json");[m
 [m
 // models[m
[31m-require('./enigma.js');[m
 require('./user_account');[m
 require('./user_page');[m
 require('./user_page_relation');[m
[36m@@ -14,6 +13,7 @@[m [mrequire('./topic');[m
 require('./topic_attachment');[m
 require('./reply');[m
 require('./notification');[m
[32m+[m[32mrequire('./enigma');[m
 [m
 exports.UserAccount = mongoose.model('UserAccount');[m
 exports.UserPage = mongoose.model('UserPage');[m
[36m@@ -26,5 +26,5 @@[m [mexports.Topic = mongoose.model('Topic');[m
 exports.TopicAttachment = mongoose.model('TopicAttachment');[m
 exports.Reply = mongoose.model('Reply');[m
 exports.Notification = mongoose.model('Notification');[m
[31m-[m
[31m-exports.EnigmaUser = mongoose.model('EnigmaUser');[m
\ No newline at end of file[m
[32m+[m[32mexports.EnigmaUser = mongoose.model('EnigmaUser');[m
[32m+[m[32mexports.EnigmaClient = mongoose.model('EnigmaClient');[m
\ No newline at end of file[m
[1mdiff --git a/src/proxy/enigma.js b/src/proxy/enigma.js[m
[1mindex 66bf88f..52182e9 100644[m
[1m--- a/src/proxy/enigma.js[m
[1m+++ b/src/proxy/enigma.js[m
[36m@@ -55,19 +55,6 @@[m [mexports.getUsersByStatus = function (status, callback) {[m
   Enigma.findOne({abolishFlag: status}, callback);[m
 };[m
 [m
[31m-/**[m
[31m- * Ê†πÊçÆÂÖ≥ÈîÆÂ≠óÔºåËé∑Âèñ‰∏ÄÁªÑÁî®Êà∑[m
[31m- * Callback:[m
[31m- * - err, Êï∞ÊçÆÂ∫ìÂºÇÂ∏∏[m
[31m- * - users, Áî®Êà∑ÂàóË°®[m
[31m- * @param {String} query ÂÖ≥ÈîÆÂ≠ó[m
[31m- * @param {Object} opt ÈÄâÈ°π[m
[31m- * @param {Function} callback ÂõûË∞ÉÂáΩÊï∞[m
[31m- */[m
[31m-exports.getUsersByQuery = function (query, opt, callback) {[m
[31m-  Enigma.find(query, [], opt, callback);[m
[31m-};[m
[31m-[m
 [m
 /**[m
  * Ê†πÊçÆÂÖ≥ÈîÆÂ≠óÔºåËé∑Âèñ‰∏ÄÁªÑÁî®Êà∑[m
[36m@@ -104,7 +91,11 @@[m [mexports.addClient = function (account, newClient, callback) {[m
     if(!newClient.lanIP || !newClient.wanIP)[m
       return callback(-1, "IP_FORMAT_ERROR");[m
 [m
[31m-    newClient = {lanIP: newClient.lanIP, wanIP: newClient.wanIP, onlineTime: Date.now()};[m
[32m+[m[32m    newClient = {[m
[32m+[m[32m      lanIP: newClient.lanIP,[m[41m [m
[32m+[m[32m      wanIP: newClient.wanIP,[m[41m [m
[32m+[m[32m      onlineTime: Date.now()[m
[32m+[m[32m    };[m
     newClient = new EnigmaCli(newClient);[m
 [m
     user.onlineClient.push(newClient);[m
[36m@@ -113,7 +104,7 @@[m [mexports.addClient = function (account, newClient, callback) {[m
 [m
     user.save(function(err){[m
       if(err) return callback(-1, "DB_ERROR");[m
[31m-      return callback(1, "SAVE_SUCCESS");[m
[32m+[m[32m      return callback(0, "SAVE_SUCCESS");[m
     });[m
   });[m
 };[m
[1mdiff --git a/src/proxy/index.js b/src/proxy/index.js[m
[1mindex 9d7f1bf..cbcfd3a 100644[m
[1m--- a/src/proxy/index.js[m
[1m+++ b/src/proxy/index.js[m
[36m@@ -10,4 +10,4 @@[m [mexports.TopicAttachment = require('./topic_attachment');[m
 exports.Reply = require('./reply');[m
 exports.Notification = require('./notification');[m
 [m
[31m-exports.Enigma = require('./enigma.js');[m
\ No newline at end of file[m
[32m+[m[32mexports.Enigma = require('./enigma');[m
\ No newline at end of file[m
